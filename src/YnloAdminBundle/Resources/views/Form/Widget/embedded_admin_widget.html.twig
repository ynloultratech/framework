{# @var admin \YnloFramework\YnloAdminBundle\Admin\AbstractAdmin #}

{% block embedded_admin_widget %}
    {% set id = random() %}
    <div id="embedded-admin-{{ id }}" style="min-height: 60px"></div>
    <script>
        (function () {
            require(['block'], function () {
                var $embedded = $('#embedded-admin-{{ id }}');

                {# load remote content #}
                var loadEmbedded = function () {
                    var listUrl = '{{ admin.generateUrl('list', { 'id' : parentId }) }}';
                    $embedded.block();
                    $embedded.load(listUrl, function () {
                        $embedded.unblock();
                    });
                };

                var init = function () {
                    $embedded.is(':empty') && loadEmbedded();
                };

                setTimeout(function () {
                    {# verify is visible for lazy load #}
                    if ($embedded.visible()) {
                        init();
                    } else {
                        $embedded.onVisible(init);
                    }
                }, 200)
            });
        })()
    </script>
{% endblock %}
