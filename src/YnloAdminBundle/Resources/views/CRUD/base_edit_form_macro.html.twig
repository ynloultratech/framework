{% macro render_groups(admin, form, groups, has_tab) %}
    {% if admin.formtabs['default'].groups is defined and admin.formtabs['default'].groups|length <= 1 and app.request.xmlHttpRequest %}
        {% for code in groups %}
            {% for field_name in admin.formgroups[code].fields %}
                {% if admin.formfielddescriptions[field_name] is defined %}
                    {{ form_row(form[field_name]) }}
                {% endif %}
            {% else %}
                <em>{{ 'message_form_group_empty'|trans({}, 'SonataAdminBundle') }}</em>
            {% endfor %}
        {% endfor %}
    {% else %}
        {% for code in groups %}
            {% set form_group = admin.formgroups[code] %}
            <div class="{{ form_group.class | default('col-md-12') }}">
                <div class="panel panel-flat {{ form_group.box_class }}">
                    <div class="panel-heading">
                        <h6 class="panel-title">
                            {% if form_group.icon is defined %}
                                <i class="{{ form_group.icon }}"></i>&nbsp;
                            {% endif %}
                            <span class="text-semibold">{{ admin.trans(form_group.name, {}, form_group.translation_domain) }}</span>
                        </h6>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-12 sonata-ba-collapsed-fields">
                                {% if form_group.description != false %}
                                    <div class="col-md-12">
                                        <p>{{ form_group.description|trans({}, form_group.translation_domain)|raw }}</p>
                                    </div>
                                {% endif %}

                                {% for field_name in form_group.fields %}
                                    {% if admin.formfielddescriptions[field_name] is defined %}
                                        {{ form_row(form[field_name]) }}
                                    {% endif %}
                                {% else %}
                                    <em>{{ 'message_form_group_empty'|trans({}, 'SonataAdminBundle') }}</em>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
{% endmacro %}
